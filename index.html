<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weer - Zeist</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            background: #8A95A5;
            color: white;
            user-select: none;
            -webkit-user-select: none;
        }
        
        #sky-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
        }
        
        .weather-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 10;
            pointer-events: none;
        }
        
        .weather-overlay * {
            pointer-events: all;
        }
        
        .top-left {
            position: absolute;
            top: 40px;
            left: 30px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        
        .day-time {
            font-size: 18px;
            font-weight: 400;
            margin-bottom: 8px;
            opacity: 0.9;
        }
        
        .temperature {
            font-size: 90px;
            font-weight: 300;
            line-height: 0.9;
            margin-bottom: 5px;
        }
        
        .temperature .degree {
            font-size: 50px;
            vertical-align: super;
            margin-left: -10px;
        }
        
        .feels-like {
            font-size: 16px;
            font-weight: 400;
            opacity: 0.8;
        }
        
        .top-right {
            position: absolute;
            top: 40px;
            right: 30px;
            text-align: right;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        
        .wind-indicator {
            width: 50px;
            height: 50px;
            border: 2px solid rgba(255,255,255,0.8);
            border-radius: 50%;
            margin: 0 auto 10px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            font-weight: 600;
            font-size: 14px;
        }
        
        .wind-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 12px solid rgba(255,255,255,0.8);
            top: -8px;
            transform-origin: center bottom;
        }
        
        .wind-text {
            font-size: 14px;
            font-weight: 400;
            opacity: 0.8;
            max-width: 150px;
        }
        
        .bottom-right {
            position: absolute;
            bottom: 120px;
            right: 30px;
            text-align: right;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        
        .precipitation {
            font-size: 16px;
            font-weight: 400;
            opacity: 0.8;
        }
        
        .bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
        }
        
        .nav-buttons {
            display: flex;
            gap: 20px;
        }
        
        .nav-button {
            padding: 8px 16px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 20px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .nav-button.active {
            background: rgba(255,255,255,0.4);
        }
        
        .nav-button:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .timeline {
            display: flex;
            gap: 15px;
            padding: 10px 0;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .timeline::-webkit-scrollbar {
            display: none;
        }
        
        .hour-item {
            flex-shrink: 0;
            text-align: center;
            cursor: pointer;
            padding: 5px;
            border-radius: 10px;
            transition: background 0.2s;
            min-width: 45px;
        }
        
        .hour-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .hour-item.active {
            background: rgba(255,255,255,0.2);
        }
        
        .hour-time {
            font-size: 12px;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .hour-emoji {
            font-size: 18px;
            margin-bottom: 2px;
        }
        
        .hour-temp {
            font-size: 12px;
            font-weight: 500;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        
        @media (max-width: 768px) {
            .top-left, .top-right {
                top: 30px;
            }
            
            .top-left, .bottom-right {
                left: 20px;
                right: auto;
            }
            
            .top-right {
                right: 20px;
                left: auto;
            }
            
            .temperature {
                font-size: 70px;
            }
            
            .bottom-nav {
                padding: 0 20px;
            }
        }
    </style>
</head>
<body>
    <canvas id="sky-canvas"></canvas>
    
    <div class="weather-overlay">
        <div class="top-left">
            <div class="day-time" id="day-time">Loading...</div>
            <div class="temperature">
                <span id="temperature">-</span><span class="degree">Â°</span>
            </div>
            <div class="feels-like">Voelt als <span id="feels-like">-</span>Â°</div>
        </div>
        
        <div class="top-right">
            <div class="wind-indicator">
                <div class="wind-arrow" id="wind-arrow"></div>
                <span id="wind-speed">-</span>
            </div>
            <div class="wind-text" id="wind-text">-</div>
        </div>
        
        <div class="bottom-right">
            <div class="precipitation" id="precipitation">-</div>
        </div>
        
        <div class="bottom-nav">
            <div class="nav-buttons">
                <button class="nav-button active">Nu</button>
                <button class="nav-button">10 dagen</button>
            </div>
            <div class="timeline" id="timeline"></div>
        </div>
        
        <div class="loading" id="loading">Weer laden...</div>
    </div>

    <script>
        class WeatherApp {
            constructor() {
                this.canvas = document.getElementById('sky-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.currentHourIndex = 0;
                this.weatherData = null;
                this.particles = [];
                this.lastTime = 0;
                
                this.setupCanvas();
                this.loadWeatherData();
                this.setupEventListeners();
                this.animate();
                
                // Auto-refresh elke 10 minuten
                setInterval(() => this.loadWeatherData(), 10 * 60 * 1000);
            }
            
            setupCanvas() {
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
            }
            
            resizeCanvas() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }
            
            async loadWeatherData() {
                try {
                    const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=52.09&longitude=5.23&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,cloud_cover,wind_speed_10m,wind_direction_10m,precipitation&hourly=temperature_2m,weather_code,cloud_cover,wind_speed_10m,wind_direction_10m,precipitation,snowfall&daily=sunrise,sunset&timezone=Europe/Amsterdam&forecast_days=2');
                    this.weatherData = await response.json();
                    
                    // Vind huidige uur
                    const now = new Date();
                    const currentISOTime = now.toISOString().slice(0, 13) + ':00';
                    this.currentHourIndex = this.weatherData.hourly.time.findIndex(time => time === currentISOTime);
                    if (this.currentHourIndex === -1) this.currentHourIndex = 0;
                    
                    this.updateUI();
                    this.createTimeline();
                    this.updateWeatherEffects();
                    
                    document.getElementById('loading').style.display = 'none';
                } catch (error) {
                    console.error('Fout bij laden weer data:', error);
                    document.getElementById('loading').textContent = 'Fout bij laden';
                }
            }
            
            updateUI() {
                if (!this.weatherData) return;
                
                const current = this.weatherData.current;
                const hourly = this.weatherData.hourly;
                const hourIndex = this.currentHourIndex;
                
                // Datum en tijd
                const date = new Date(hourly.time[hourIndex]);
                const dayNames = ['Zondag', 'Maandag', 'Dinsdag', 'Woensdag', 'Donderdag', 'Vrijdag', 'Zaterdag'];
                const dayName = dayNames[date.getDay()];
                const timeStr = date.toLocaleTimeString('nl-NL', {hour: '2-digit', minute: '2-digit'});
                document.getElementById('day-time').textContent = `${dayName} ${timeStr}`;
                
                // Temperatuur
                const temp = Math.round(hourly.temperature_2m[hourIndex]);
                const feelsLike = Math.round(current.apparent_temperature);
                document.getElementById('temperature').textContent = temp;
                document.getElementById('feels-like').textContent = feelsLike;
                
                // Wind
                const windSpeed = Math.round(hourly.wind_speed_10m[hourIndex]);
                const windDir = hourly.wind_direction_10m[hourIndex];
                document.getElementById('wind-speed').textContent = windSpeed;
                document.getElementById('wind-arrow').style.transform = `rotate(${windDir + 180}deg)`;
                
                const windTexts = {
                    0: 'Windstil', 5: 'Zwakke wind', 12: 'Matige wind', 
                    20: 'Vrij krachtige wind', 29: 'Krachtige wind', 39: 'Harde wind'
                };
                let windDescription = 'Windstil';
                for (const [speed, desc] of Object.entries(windTexts)) {
                    if (windSpeed >= parseInt(speed)) windDescription = desc;
                }
                document.getElementById('wind-text').textContent = windDescription;
                
                // Neerslag
                const precipitation = hourly.precipitation[hourIndex];
                const snowfall = hourly.snowfall[hourIndex];
                let precipText = '';
                if (snowfall > 0) {
                    precipText = `Sneeuw ${snowfall.toFixed(1)} mm`;
                } else if (precipitation > 0) {
                    precipText = `Regen ${precipitation.toFixed(1)} mm`;
                } else {
                    precipText = 'Geen neerslag';
                }
                document.getElementById('precipitation').textContent = precipText;
            }
            
            createTimeline() {
                if (!this.weatherData) return;
                
                const timeline = document.getElementById('timeline');
                timeline.innerHTML = '';
                
                // Toon komende 24 uur
                for (let i = 0; i < 24; i++) {
                    const hourIndex = this.currentHourIndex + i;
                    if (hourIndex >= this.weatherData.hourly.time.length) break;
                    
                    const date = new Date(this.weatherData.hourly.time[hourIndex]);
                    const temp = Math.round(this.weatherData.hourly.temperature_2m[hourIndex]);
                    const weatherCode = this.weatherData.hourly.weather_code[hourIndex];
                    const emoji = this.getWeatherEmoji(weatherCode);
                    
                    const hourItem = document.createElement('div');
                    hourItem.className = 'hour-item';
                    if (i === 0) hourItem.classList.add('active');
                    
                    hourItem.innerHTML = `
                        <div class="hour-time">${date.getHours().toString().padStart(2, '0')}:00</div>
                        <div class="hour-emoji">${emoji}</div>
                        <div class="hour-temp">${temp}Â°</div>
                    `;
                    
                    hourItem.addEventListener('click', () => {
                        this.currentHourIndex = hourIndex;
                        this.updateUI();
                        this.updateWeatherEffects();
                        
                        // Update active state
                        timeline.querySelectorAll('.hour-item').forEach(item => item.classList.remove('active'));
                        hourItem.classList.add('active');
                    });
                    
                    timeline.appendChild(hourItem);
                }
            }
            
            getWeatherEmoji(weatherCode) {
                const weatherEmojis = {
                    0: 'â˜€ï¸',   // Clear sky
                    1: 'ðŸŒ¤ï¸',   // Mainly clear
                    2: 'â›…',   // Partly cloudy
                    3: 'â˜ï¸',   // Overcast
                    45: 'ðŸŒ«ï¸',  // Fog
                    48: 'ðŸŒ«ï¸',  // Depositing rime fog
                    51: 'ðŸŒ¦ï¸',  // Light drizzle
                    53: 'ðŸŒ¦ï¸',  // Moderate drizzle
                    55: 'ðŸŒ§ï¸',  // Dense drizzle
                    61: 'ðŸŒ¦ï¸',  // Slight rain
                    63: 'ðŸŒ§ï¸',  // Moderate rain
                    65: 'ðŸŒ§ï¸',  // Heavy rain
                    71: 'ðŸŒ¨ï¸',  // Slight snow
                    73: 'â„ï¸',  // Moderate snow
                    75: 'â„ï¸',  // Heavy snow
                    80: 'ðŸŒ¦ï¸',  // Slight rain showers
                    81: 'ðŸŒ§ï¸',  // Moderate rain showers
                    82: 'â›ˆï¸',  // Violent rain showers
                    95: 'â›ˆï¸',  // Thunderstorm
                };
                return weatherEmojis[weatherCode] || 'â˜ï¸';
            }
            
            updateWeatherEffects() {
                if (!this.weatherData) return;
                
                const weatherCode = this.weatherData.hourly.weather_code[this.currentHourIndex];
                const cloudCover = this.weatherData.hourly.cloud_cover[this.currentHourIndex];
                const precipitation = this.weatherData.hourly.precipitation[this.currentHourIndex];
                const snowfall = this.weatherData.hourly.snowfall[this.currentHourIndex];
                
                // Reset particles
                this.particles = [];
                
                // Create weather particles
                if (snowfall > 0) {
                    this.createSnowParticles(Math.min(snowfall * 40 + 100, 300));
                } else if (precipitation > 0) {
                    this.createRainParticles(Math.min(precipitation * 30 + 50, 200));
                }
            }
            
            createSnowParticles(count) {
                for (let i = 0; i < count; i++) {
                    this.particles.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height - this.canvas.height,
                        size: Math.random() * 8 + 4, // 4-12px zoals gevraagd
                        speed: Math.random() * 1 + 0.5,
                        opacity: Math.random() * 0.7 + 0.3,
                        drift: Math.random() * 2 - 1,
                        blur: Math.random() > 0.7, // 30% blur voor depth effect
                        type: 'snow'
                    });
                }
            }
            
            createRainParticles(count) {
                for (let i = 0; i < count; i++) {
                    this.particles.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height - this.canvas.height,
                        length: Math.random() * 15 + 10,
                        speed: Math.random() * 3 + 2,
                        opacity: Math.random() * 0.5 + 0.3,
                        type: 'rain'
                    });
                }
            }
            
            drawSky() {
                if (!this.weatherData) return;
                
                const weatherCode = this.weatherData.hourly.weather_code[this.currentHourIndex];
                const cloudCover = this.weatherData.hourly.cloud_cover[this.currentHourIndex];
                const date = new Date(this.weatherData.hourly.time[this.currentHourIndex]);
                const sunrise = new Date(this.weatherData.daily.sunrise[0]);
                const sunset = new Date(this.weatherData.daily.sunset[0]);
                
                // Bepaal tijd van dag
                const isNight = date < sunrise || date > sunset;
                const isCloudyOrSnow = cloudCover > 50 || this.weatherData.hourly.snowfall[this.currentHourIndex] > 0;
                
                let gradient;
                
                if (isCloudyOrSnow) {
                    // Grijze, gedempte lucht
                    gradient = this.ctx.createLinearGradient(0, 0, 0, this.canvas.height);
                    gradient.addColorStop(0, '#8A95A5');
                    gradient.addColorStop(0.5, '#A8B5C4');
                    gradient.addColorStop(1, '#BCC8D4');
                } else if (isNight) {
                    // Donkerblauwe nachtlucht
                    gradient = this.ctx.createLinearGradient(0, 0, 0, this.canvas.height);
                    gradient.addColorStop(0, '#0B1A30');
                    gradient.addColorStop(0.5, '#1A2D4A');
                    gradient.addColorStop(1, '#2A3D5A');
                } else {
                    // Zachte blauwe daglucht
                    gradient = this.ctx.createLinearGradient(0, 0, 0, this.canvas.height);
                    gradient.addColorStop(0, '#5B9BD5');
                    gradient.addColorStop(0.5, '#87CEEB');
                    gradient.addColorStop(1, '#C4E0F0');
                }
                
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Teken subtiele wolkenvormen
                if (isCloudyOrSnow) {
                    this.drawClouds();
                }
                
                // Teken sterren bij nacht
                if (isNight && !isCloudyOrSnow) {
                    this.drawStars();
                }
            }
            
            drawClouds() {
                this.ctx.save();
                this.ctx.globalCompositeOperation = 'multiply';
                this.ctx.filter = 'blur(20px)';
                
                for (let i = 0; i < 8; i++) {
                    this.ctx.fillStyle = `rgba(120, 120, 120, ${0.1 + Math.random() * 0.2})`;
                    this.ctx.beginPath();
                    this.ctx.arc(
                        Math.random() * this.canvas.width,
                        Math.random() * this.canvas.height,
                        Math.random() * 200 + 100,
                        0, Math.PI * 2
                    );
                    this.ctx.fill();
                }
                
                this.ctx.restore();
            }
            
            drawStars() {
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                for (let i = 0; i < 50; i++) {
                    const x = Math.random() * this.canvas.width;
                    const y = Math.random() * this.canvas.height * 0.7; // Alleen in bovenste gedeelte
                    const size = Math.random() * 2 + 1;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, size, 0, Math.PI * 2);
                    this.ctx.fill();
                }
            }
            
            updateParticles(deltaTime) {
                this.particles.forEach(particle => {
                    if (particle.type === 'snow') {
                        particle.y += particle.speed * deltaTime * 0.1;
                        particle.x += particle.drift * deltaTime * 0.05;
                        
                        if (particle.y > this.canvas.height) {
                            particle.y = -particle.size;
                            particle.x = Math.random() * this.canvas.width;
                        }
                        if (particle.x > this.canvas.width) particle.x = 0;
                        if (particle.x < 0) particle.x = this.canvas.width;
                    } else if (particle.type === 'rain') {
                        particle.y += particle.speed * deltaTime * 0.2;
                        particle.x -= deltaTime * 0.1; // Lichte schuine hoek
                        
                        if (particle.y > this.canvas.height) {
                            particle.y = -particle.length;
                            particle.x = Math.random() * this.canvas.width;
                        }
                        if (particle.x < -particle.length) {
                            particle.x = this.canvas.width + particle.length;
                        }
                    }
                });
            }
            
            drawParticles() {
                this.particles.forEach(particle => {
                    this.ctx.save();
                    
                    if (particle.type === 'snow') {
                        if (particle.blur) {
                            this.ctx.filter = 'blur(1px)';
                        }
                        this.ctx.fillStyle = `rgba(255, 255, 255, ${particle.opacity})`;
                        this.ctx.beginPath();
                        this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                        this.ctx.fill();
                    } else if (particle.type === 'rain') {
                        this.ctx.strokeStyle = `rgba(200, 200, 255, ${particle.opacity})`;
                        this.ctx.lineWidth = 1;
                        this.ctx.beginPath();
                        this.ctx.moveTo(particle.x, particle.y);
                        this.ctx.lineTo(particle.x - 5, particle.y + particle.length);
                        this.ctx.stroke();
                    }
                    
                    this.ctx.restore();
                });
            }
            
            setupEventListeners() {
                let touchStartX = 0;
                let touchStartY = 0;
                
                this.canvas.addEventListener('touchstart', (e) => {
                    touchStartX = e.touches[0].clientX;
                    touchStartY = e.touches[0].clientY;
                });
                
                this.canvas.addEventListener('touchend', (e) => {
                    const touchEndX = e.changedTouches[0].clientX;
                    const touchEndY = e.changedTouches[0].clientY;
                    
                    const deltaX = touchEndX - touchStartX;
                    const deltaY = touchEndY - touchStartY;
                    
                    // Horizontaal swipen voor tijd veranderen
                    if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
                        if (deltaX > 0 && this.currentHourIndex > 0) {
                            // Swipe right - vorige tijd
                            this.currentHourIndex--;
                        } else if (deltaX < 0 && this.currentHourIndex < this.weatherData.hourly.time.length - 1) {
                            // Swipe left - volgende tijd
                            this.currentHourIndex++;
                        }
                        
                        this.updateUI();
                        this.updateWeatherEffects();
                        this.updateTimelineActive();
                    }
                });
                
                // Mouse events voor desktop
                let mouseDown = false;
                let mouseStartX = 0;
                
                this.canvas.addEventListener('mousedown', (e) => {
                    mouseDown = true;
                    mouseStartX = e.clientX;
                });
                
                this.canvas.addEventListener('mouseup', (e) => {
                    if (!mouseDown) return;
                    mouseDown = false;
                    
                    const deltaX = e.clientX - mouseStartX;
                    
                    if (Math.abs(deltaX) > 50) {
                        if (deltaX > 0 && this.currentHourIndex > 0) {
                            this.currentHourIndex--;
                        } else if (deltaX < 0 && this.currentHourIndex < this.weatherData.hourly.time.length - 1) {
                            this.currentHourIndex++;
                        }
                        
                        this.updateUI();
                        this.updateWeatherEffects();
                        this.updateTimelineActive();
                    }
                });
                
                this.canvas.addEventListener('mouseleave', () => {
                    mouseDown = false;
                });
            }
            
            updateTimelineActive() {
                const timeline = document.getElementById('timeline');
                const hourItems = timeline.querySelectorAll('.hour-item');
                hourItems.forEach((item, index) => {
                    item.classList.toggle('active', index === 0);
                });
            }
            
            animate(currentTime = 0) {
                const deltaTime = currentTime - this.lastTime;
                this.lastTime = currentTime;
                
                // Clear canvas
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Draw sky background
                this.drawSky();
                
                // Update and draw particles
                this.updateParticles(deltaTime);
                this.drawParticles();
                
                requestAnimationFrame((time) => this.animate(time));
            }
        }
        
        // Start de app
        new WeatherApp();
    </script>
</body>
</html>